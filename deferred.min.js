(function(){var n,e,r,t,u,o,i,l,a,c,s,f,p,h,d=[].slice;u="2.4.0",e="pending",t="resolved",r="rejected",a=function(n,e){return null!=n?n.hasOwnProperty(e):void 0},s=function(n){return a(n,"length")&&a(n,"callee")},f=function(n){return a(n,"promise")&&"function"==typeof(null!=n?n.promise:void 0)},l=function(n){return s(n)?l(Array.prototype.slice.call(n)):Array.isArray(n)?n.reduce(function(n,e){return Array.isArray(e)?n.concat(l(e)):(n.push(e),n)},[]):[n]},o=function(n,e){return 0>=n?e():function(){return--n<1?e.apply(this,arguments):void 0}},p=function(n,e){return function(){var r;return r=[n].concat(Array.prototype.slice.call(arguments,0)),e.apply(this,r)}},i=function(n,e,r){var t,u,o,i,a;for(i=l(n),a=[],u=0,o=i.length;o>u;u++)t=i[u],a.push(t.call.apply(t,[r].concat(d.call(e))));return a},n=function(){var u,o,a,c,s,p;return p=e,c=[],s=[],a={},this.promise=function(u){var o,h;return u=u||{},u.state=function(){return p},h=function(n,r){return function(){return p===e&&r.push.apply(r,l(arguments)),n()&&i(arguments,a),u}},u.done=h(function(){return p===t},c),u.fail=h(function(){return p===r},s),u.always=function(){var n;return(n=u.done.apply(u,arguments)).fail.apply(n,arguments)},o=function(e,r){var t,o;return o=new n,t=function(n,e,r){return r?u[n](function(){var n,t;return n=1<=arguments.length?d.call(arguments,0):[],t=r.apply(null,n),f(t)?t.done(o.resolve).fail(o.reject):o[e](t)}):u[n](o[e])},t("done","resolve",e),t("fail","reject",r),o},u.pipe=o,u.then=o,null==u.promise&&(u.promise=function(){return u}),u},this.promise(this),u=this,o=function(n,r,t){return function(){return p===e?(p=n,a=arguments,i(r,a,t),u):this}},this.resolve=o(t,c),this.reject=o(r,s),this.resolveWith=function(n,e){return o(t,c,n).apply(null,e)},this.rejectWith=function(n,e){return o(r,s,n).apply(null,e)},this},h=function(){var e,r,t,u,i,a,c;if(r=l(arguments),1===r.length)return f(r[0])?r[0]:(new n).resolve(r[0]).promise();if(i=new n,!r.length)return i.resolve().promise();for(u=[],t=o(r.length,function(){return i.resolve.apply(i,u)}),r.forEach(function(n,e){return f(n)?n.done(function(){var n;return n=1<=arguments.length?d.call(arguments,0):[],u[e]=n.length>1?n:n[0],t()}):(u[e]=n,t())}),a=0,c=r.length;c>a;a++)e=r[a],f(e)&&e.fail(i.reject);return i.promise()},c=function(e){return e.Deferred=function(){return new n},e.ajax=p(e.ajax,function(e,r){var t,u,o,i;return null==r&&(r={}),u=new n,t=function(n,e){return p(n,function(){var n,r;return r=arguments[0],n=2<=arguments.length?d.call(arguments,1):[],r&&r.apply(null,n),e.apply(null,n)})},r.success=t(r.success,u.resolve),r.error=t(r.error,u.reject),i=e(r),o=u.promise(),o.abort=function(){return i.abort()},o}),e.when=h},"undefined"!=typeof exports?(exports.Deferred=function(){return new n},exports.when=h,exports.installInto=c):"function"==typeof define&&define.amd?define(function(){return"undefined"!=typeof Zepto?c(Zepto):n}):"undefined"!=typeof Zepto?c(Zepto):(this.Deferred=function(){return new n},this.Deferred.when=h,this.Deferred.installInto=c)}).call(this);